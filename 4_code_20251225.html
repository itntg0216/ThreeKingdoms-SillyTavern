<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>æ±‰æœ«çº¢é¢œå½•Â·è‡ªå®šä¹‰è§’è‰²ï¼ˆç§»åŠ¨ç«¯é€‚é…ï¼‰</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+SC:wght@400;500;700&display=swap');

        /* åŸºç¡€æ ·å¼ä¼˜åŒ–ï¼ˆç§»åŠ¨ç«¯ä¼˜å…ˆï¼‰ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg-color: #f5efe6;
            --text-color: #4a3b31;
            --border-color: #d3c5b3;
            --border-strong-color: #785a4e;
            --title-color: #5d4037;
            --link-color: #8c6d62;
            --item-bg-color: rgba(253, 250, 245, 0.95);
            --item-bg-hover-color: #e8ddcb;
            --item-bg-selected-color: #d7c8b6;
            --pre-bg-color: rgba(215, 200, 182, 0.3);
            --container-bg-color: rgba(240, 230, 210, 0.95);
            --title-font: 'Cinzel', serif;
            --body-font: 'Noto Serif SC', serif;
        }

        body {
            font-family: var(--body-font);
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 15px;
            min-height: 100vh;
            background-image: url('data:image/png;base64,iVBORw0KUAhEUgAAADIAAAAyCAMAAAAp4XiGAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAADdAAAA3QFwU6IHAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAABbUExURQAAAP////f3+Pj4+fX19vb2+PT09Pj4+d/f4O/v8fPz9PX19vf3+Pn5+fb29/Hx8/T09fX19fX19////97e4Ojo6fHx8/Ly8/X19fX19fDw8vX19e/v8fj4+Pf3+AAAADSAx5YAAAAfdFJOUwAAAAAAAAAAAAAAAMA/z/BAgMBAwBCgwFBPT1BQUD9/Py8vRkQoCgAAAQBJREFUSMftlVuSgyAQhUNtZRAScQExPff9H3CBQsEMZDDpOf2EM8P9NZnZzI5KEfEPMGOIsIApFgAAFDtAAmWiIAMAWGDVQDQAAkYMm9RhpJbrBLhZ1Z6yGvWq2xWA92i6ZXRtC50EAADg0n8ErvDY2esxAEBW96Fz0Npq7H0AGBzh6MrAgAAgAEEyNiyL00mDgCsvt9jX6gAEEPg2pS8HAABgB2b0ONnuaR4AQDG9OQCAfQD8XRsBACJmk/+1WwUALg7A8IUBjgh0JGBgAJY2YB+S/VB9aKjpx5EDP5HAPk7Jm4tJgLeJ3I0LANT3/k7K/r5Q/AAAFYxxfYq1LAAAAABJRU5ErkJggg==');
            background-repeat: repeat;
            background-size: auto;
        }

        .selector-scroll {
            border: 2px solid var(--border-strong-color);
            border-radius: 12px;
            padding: 20px 15px;
            background-color: var(--container-bg-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
        }

        .page-super-title {
            font-family: var(--title-font);
            font-weight: 700;
            text-align: center;
            font-size: 2em;
            color: var(--title-color);
            margin: 10px 0 15px;
            letter-spacing: 1px;
        }

        .ornamental-divider {
            border: 0;
            height: 1px;
            background-color: var(--border-color);
            position: relative;
            margin: 20px auto;
            width: 70%;
        }

        .ornamental-divider::after {
            content: 'â–';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--container-bg-color);
            padding: 0 12px;
            color: var(--title-color);
            font-size: 1.4em;
            line-height: 1;
        }

        .info-panel {
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--item-bg-color);
        }

        .info-panel > summary {
            font-family: var(--title-font);
            font-weight: 700;
            font-size: 1em;
            color: var(--title-color);
            background-color: var(--item-bg-selected-color);
            padding: 12px 15px;
            cursor: pointer;
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .arrow-toggle {
            font-size: 0.9em;
        }

        .info-content {
            padding: 15px;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .info-content h3 {
            font-family: var(--title-font);
            color: var(--title-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 6px;
            margin: 15px 0 10px;
            font-size: 1.2em;
        }

        .world-quote {
            background-color: rgba(245, 239, 230, 0.5);
            border-left: 3px solid var(--border-strong-color);
            padding: 10px 15px;
            margin: 12px 0;
            font-style: italic;
            color: #5d4037;
            font-size: 0.9em;
        }

        .main-title {
            font-family: var(--title-font);
            font-weight: 700;
            color: var(--title-color);
            text-align: center;
            margin: 0 0 15px;
            font-size: 1.6em;
        }

        .instructions {
            text-align: center;
            margin-bottom: 20px;
            font-size: 0.9em;
            color: #6a514d;
            line-height: 1.5;
        }

        /* æŒ‰é’®æ ·å¼ï¼ˆç§»åŠ¨ç«¯è§¦æ‘¸ä¼˜åŒ–ï¼‰ */
        .recheck-button, .submit-button {
            font-family: var(--body-font);
            font-weight: 500;
            font-size: 1em;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .recheck-button {
            color: var(--title-color);
            background-color: var(--item-bg-color);
            border: 1px solid var(--border-color);
            margin: 0 5px;
            min-width: 120px;
        }

        .recheck-button:hover, .recheck-button:active {
            background-color: var(--item-bg-hover-color);
            border-color: var(--border-strong-color);
            transform: scale(1.03);
        }

        .submit-button {
            font-family: var(--title-font);
            color: var(--title-color);
            background-color: var(--item-bg-selected-color);
            border: 1px solid var(--border-strong-color);
            width: 100%;
            margin-top: 15px;
            padding: 14px;
            font-size: 1.05em;
        }

        .submit-button:hover, .submit-button:active {
            background-color: #c9bba9;
            transform: scale(1.02);
        }

        .step-footer {
            text-align: center;
            margin-top: 25px;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* é€‰é¡¹åˆ—è¡¨ï¼ˆç§»åŠ¨ç«¯è§¦æ‘¸ä¼˜åŒ–ï¼‰ */
        .scenario-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            padding: 0;
            margin: 0;
            list-style: none;
        }

        .scenario-option {
            font: inherit;
            color: inherit;
            background: var(--item-bg-color);
            border: 1px solid var(--border-color);
            text-align: left;
            width: 100%;
            padding: 15px 15px 15px 45px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            font-size: 1em;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .scenario-option::before {
            content: 'ğŸ“œ';
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
            opacity: 0.7;
        }

        .scenario-option:hover, .scenario-option:active {
            background-color: var(--item-bg-hover-color);
            border-color: var(--border-strong-color);
            transform: translateX(3px);
        }

        .scenario-option.selected {
            background-color: var(--item-bg-selected-color);
            border-color: var(--title-color);
            color: var(--title-color);
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .scenario-option.selected::after {
            content: 'âœ“';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: bold;
            color: var(--title-color);
        }

        .control-panel-container {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: rgba(253, 250, 245, 0.95);
            padding: 15px;
            margin: 20px 0;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
        }

        /* è¡¨å•æ ·å¼ï¼ˆç§»åŠ¨ç«¯é€‚é…ï¼‰ */
        .custom-char-form {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 500;
            color: var(--title-color);
            font-size: 1em;
        }

        .form-input {
            padding: 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: var(--body-font);
            font-size: 1em;
            background-color: var(--item-bg-color);
            color: var(--text-color);
            width: 100%;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--border-strong-color);
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1 1 calc(50% - 4px);
            min-width: 140px;
            font-size: 0.9em;
        }

        .radio-option:hover, .radio-option:active {
            background-color: var(--item-bg-hover-color);
            border-color: var(--border-strong-color);
        }

        .radio-option input {
            accent-color: var(--border-strong-color);
            transform: scale(1.2);
            margin-right: 5px;
        }

        .radio-option.selected {
            background-color: var(--item-bg-selected-color);
            border-color: var(--title-color);
        }

        /* å±æ€§æ»‘å—ï¼ˆç§»åŠ¨ç«¯é€‚é…ï¼‰ */
        .stats-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .stat-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-name {
            font-weight: 500;
            font-size: 1em;
        }

        .stat-value {
            color: var(--border-strong-color);
            font-weight: 700;
            font-size: 1.1em;
        }

        .stat-slider {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background-color: var(--border-color);
            accent-color: var(--border-strong-color);
            cursor: pointer;
            touch-action: manipulation;
        }

        .stat-desc {
            font-size: 0.85em;
            color: #6a514d;
            margin-top: 3px;
        }

        /* è‡ªå®šä¹‰è¾“å…¥ç»„ */
        .custom-input-group {
            margin-top: 10px;
            display: none;
        }

        .custom-input-group.active {
            display: block;
        }

        /* å‰§æƒ…æ–‡æœ¬åŸŸï¼ˆç§»åŠ¨ç«¯é€‚é…ï¼‰ */
        .scenario-textarea {
            width: 100%;
            min-height: 150px;
            padding: 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: var(--body-font);
            font-size: 1em;
            background-color: var(--item-bg-color);
            color: var(--text-color);
            resize: vertical;
            margin-top: 10px;
        }

        /* è§’è‰²æ‘˜è¦ï¼ˆç§»åŠ¨ç«¯é€‚é…ï¼‰ */
        #charSummary, #plotSummary {
            line-height: 1.8;
            font-size: 0.95em;
        }

        #charSummary h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        /* æ­¥éª¤å†…å®¹ï¼ˆé»˜è®¤æ˜¾ç¤ºï¼Œé€šè¿‡JSæ§åˆ¶displayï¼‰ */
        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* éšè—PCç«¯å†—ä½™å…ƒç´  */
        .clear-cache-button, .env-check-container {
            display: none;
        }
    </style>
</head>
<body>
    <div class="selector-scroll">
        <h1 class="page-super-title">æ±‰æœ«çº¢é¢œå½•</h1>
        <hr class="ornamental-divider" />

        <details class="info-panel">
            <summary>
                <span>æ±‰æœ«ä¹±ä¸–èƒŒæ™¯</span>
                <span class="arrow-toggle">â—€</span>
            </summary>
            <div class="info-content">
                <h3>å»ºå®‰å¹´é—´Â·ä¹å·æ¿è¡</h3>
                <p>
                    ä¸œæ±‰æœ«å¹´ï¼Œçµå¸æ˜åº¸ï¼Œé»„å·¾èœ‚èµ·ï¼Œè‘£å“ä¹±æ”¿ï¼Œç¾¤é›„å‰²æ®ã€‚å¤©ä¸‹å¤§ä¹±ä¹‹é™…ï¼Œå¥³å­äº¦æœ‰åˆ«æ ·äººç”Ÿâ€”â€”å¯ä¸ºäººå¦»ç›¸å¤«æ•™å­ï¼Œå¯åŠ©å¤«å›ç†æ”¿æ–­äº‹ï¼Œå¯äºä¹±ä¸–ä¸­åšå®ˆå®¶æ—ï¼Œäº¦å¯å‡­å·±èº«æ‰æ™ºç«‹è¶³äºä¸–ã€‚
                </p>
                <div class="world-quote">â€œå¤©ä¸‹å¤§åŠ¿ï¼Œåˆ†ä¹…å¿…åˆï¼Œåˆä¹…å¿…åˆ†ã€‚â€</div>
                <p>
                    è¿™é‡Œæ²¡æœ‰é­”æ³•ç¥è¿¹ï¼Œåªæœ‰åˆ€å…‰å‰‘å½±ä¸äººå¿ƒåšå¼ˆï¼›æ²¡æœ‰å±‚çº§æ¡æ¢ï¼Œåªéœ€éµä»æœ¬å¿ƒï¼Œåœ¨è¿™ä¹±ä¸–ä¹‹ä¸­ï¼Œèµ°å‡ºå±äºä½ çš„çº¢é¢œä¹‹è·¯ã€‚
                </p>
            </div>
        </details>

        <!-- æ­¥éª¤1ï¼šå¼€åœºå¼•å¯¼ -->
        <div id="step-1" class="step-content active">
            <h2 class="main-title">å¼€å¯ä½ çš„æ±‰æœ«äººç”Ÿ</h2>
            <p class="instructions">é€‰æ‹©ä½ æƒ³è¦çš„å¼€å±€æ–¹å¼ï¼Œæˆ–ç›´æ¥è‡ªå®šä¹‰ä¸“å±è§’è‰²</p>
            <div class="control-panel-container">
                <ul class="scenario-list">
                    <li><button class="scenario-option" data-action="custom" data-button-id="select-custom">è‡ªå®šä¹‰ä¸“å±çº¢é¢œè§’è‰²</button></li>
                    <li><button class="scenario-option" data-action="preset" data-button-id="select-preset">é€‰æ‹©é¢„è®¾å¼€å±€åœºæ™¯</button></li>
                </ul>
            </div>
            <div class="step-footer">
                <button id="step1-next" class="recheck-button" data-button-id="step1-next">è¿›å…¥ä¸‹ä¸€æ­¥</button>
            </div>
        </div>

        <!-- æ­¥éª¤2ï¼šé¢„è®¾å¼€å±€åœºæ™¯ -->
        <div id="step-2" class="step-content">
            <h2 class="main-title">é€‰æ‹©å¼€å±€åœºæ™¯</h2>
            <p class="instructions">æŒ‘é€‰ä½ çš„èµ·ç‚¹ï¼Œå¼€å¯æ±‰æœ«æ—…ç¨‹</p>
            <div class="control-panel-container">
                <ul class="scenario-list">
                    <li><button class="scenario-option" data-scene="1" data-button-id="scene-1">æ´›é˜³æ·±å®…Â·è¯¸ä¾¯ä¹‹å¦»</button></li>
                    <li><button class="scenario-option" data-scene="2" data-button-id="scene-2">è¥„é˜³åˆ«é™¢Â·åå£«ä¹‹å¦»</button></li>
                    <li><button class="scenario-option" data-scene="3" data-button-id="scene-3">æ±Ÿä¸œæ°´ä¹¡Â·å°†é—¨ä¹‹å¦»</button></li>
                    <li><button class="scenario-option" data-scene="4" data-button-id="scene-4">æ¶¿å¿å†œå®¶Â·å¹³æ°‘ä¹‹å¦»</button></li>
                    <li><button class="scenario-option" data-scene="5" data-button-id="scene-5">é•¿å®‰å¤é“Â·æµäº¡è´µå¥³</button></li>
                    <li><button class="scenario-option" data-scene="6" data-button-id="scene-6">æˆéƒ½å¸‚äº•Â·å•†æˆ·ä¹‹å¦»</button></li>
                </ul>
            </div>
            <div class="step-footer">
                <button id="step2-prev" class="recheck-button" data-button-id="step2-prev">è¿”å›ä¸Šä¸€æ­¥</button>
                <button id="step2-next" class="recheck-button" data-button-id="step2-next">ç¡®è®¤å¼€å±€</button>
            </div>
        </div>

        <!-- æ­¥éª¤3ï¼šè‡ªå®šä¹‰è§’è‰² -->
        <div id="step-3" class="step-content">
            <h2 class="main-title">è‡ªå®šä¹‰ä¸“å±çº¢é¢œ</h2>
            <p class="instructions">å®Œå–„ä½ çš„è§’è‰²ä¿¡æ¯ï¼Œæ‰“é€ ç‹¬ä¸€æ— äºŒçš„æ±‰æœ«äººç”Ÿ</p>
            <div class="control-panel-container">
                <form id="customCharForm" data-form-id="customCharForm">
                    <!-- åŸºç¡€ä¿¡æ¯ -->
                    <div class="form-group">
                        <label class="form-label">å§“å</label>
                        <input type="text" class="form-input" id="charName" placeholder="è¾“å…¥ä½ çš„å§“åï¼ˆå¦‚ï¼šç”„æ°ã€è”¡ç°ï¼‰" required>
                    </div>

                    <!-- è‡ªå®šä¹‰èº«ä»½ï¼ˆå¡«ç©ºå¼ï¼‰ -->
                    <div class="form-group">
                        <label class="form-label">èº«ä»½èƒŒæ™¯ï¼ˆè‡ªå®šä¹‰ï¼Œè´´åˆå²å®å¥³æ€§è®¾å®šï¼‰</label>
                        <input type="text" class="form-input" id="charIdentity" placeholder="è¾“å…¥ä½ çš„èº«ä»½ï¼ˆå¦‚ï¼šéƒ¡å®ˆä¹‹å¥³ã€ç»£åŠä¸»æ¯ã€åŒ»é¦†ä¼ äººï¼‰" required>
                    </div>

                    <!-- å¹´é¾„ -->
                    <div class="form-group">
                        <label class="form-label">å¹´é¾„ï¼ˆ16-40å²ï¼Œç¬¦åˆæ±‰æœ«å¥³æ€§æ´»åŠ¨å¹´é¾„ï¼‰</label>
                        <input type="number" class="form-input" id="charAge" min="16" max="40" value="18" required>
                    </div>

                    <!-- é…å¶ä¿¡æ¯ -->
                    <div class="form-group">
                        <label class="form-label">é…å¶æƒ…å†µï¼ˆç¬¦åˆå²å®è®¾å®šï¼‰</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="spouse" value="è¯¸ä¾¯åå°†" checked> è¯¸ä¾¯/åå°†
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="spouse" value="åå£«æ–‡äºº"> åå£«/æ–‡äºº
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="spouse" value="åœ°æ–¹å®˜å"> åœ°æ–¹å®˜å
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="spouse" value="å¹³æ°‘å•†æˆ·"> å¹³æ°‘/å•†æˆ·
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="spouse" value="æš‚æ— é…å¶"> æš‚æ— é…å¶
                            </label>
                        </div>
                    </div>

                    <!-- å®¶æ—èƒŒæ™¯ -->
                    <div class="form-group">
                        <label class="form-label">å®¶æ—èƒŒæ™¯</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="family" value="åé—¨æœ›æ—" checked> åé—¨æœ›æ—
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="family" value="ä¹¦é¦™é—¨ç¬¬"> ä¹¦é¦™é—¨ç¬¬
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="family" value="æ­¦å°†ä¸–å®¶"> æ­¦å°†ä¸–å®¶
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="family" value="æ™®é€šå¹³æ°‘"> æ™®é€šå¹³æ°‘
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="family" value="è´¥è½å®¶æ—"> è´¥è½å®¶æ—
                            </label>
                        </div>
                    </div>

                    <!-- æ ¸å¿ƒå±æ€§ -->
                    <div class="form-group">
                        <label class="form-label">æ ¸å¿ƒå±æ€§ï¼ˆæ¯é¡¹å¯åˆ†é…1-10ç‚¹ï¼Œæ€»åˆ†35ç‚¹ï¼‰</label>
                        <div class="stats-container">
                            <!-- æ­¦åŠ› -->
                            <div class="stat-item">
                                <div class="stat-label">
                                    <span class="stat-name">æ­¦åŠ›</span>
                                    <span class="stat-value" id="forceValue">5</span>
                                </div>
                                <input type="range" class="stat-slider" id="forceSlider" min="1" max="10" value="5">
                                <p class="stat-desc">è¿‘æˆ˜èƒ½åŠ›ã€é©¬æœ¯ç®­æœ¯</p>
                            </div>
                            <!-- ä½“é­„ -->
                            <div class="stat-item">
                                <div class="stat-label">
                                    <span class="stat-name">ä½“é­„</span>
                                    <span class="stat-value" id="bodyValue">7</span>
                                </div>
                                <input type="range" class="stat-slider" id="bodySlider" min="1" max="10" value="7">
                                <p class="stat-desc">èº«ä½“ç´ è´¨ã€æŠ—ç–¾èƒ½åŠ›</p>
                            </div>
                            <!-- æ™ºè°‹ -->
                            <div class="stat-item">
                                <div class="stat-label">
                                    <span class="stat-name">æ™ºè°‹</span>
                                    <span class="stat-value" id="wisdomValue">7</span>
                                </div>
                                <input type="range" class="stat-slider" id="wisdomSlider" min="1" max="10" value="7">
                                <p class="stat-desc">è°‹ç•¥è§„åˆ’ã€åº”å˜èƒ½åŠ›</p>
                            </div>
                            <!-- é¢†å¯¼ -->
                            <div class="stat-item">
                                <div class="stat-label">
                                    <span class="stat-name">é¢†å¯¼</span>
                                    <span class="stat-value" id="leadValue">5</span>
                                </div>
                                <input type="range" class="stat-slider" id="leadSlider" min="1" max="10" value="5">
                                <p class="stat-desc">ç»Ÿç­¹åè°ƒã€äººå¿ƒæŠŠæ§</p>
                            </div>
                            <!-- é­…åŠ› -->
                            <div class="stat-item">
                                <div class="stat-label">
                                    <span class="stat-name">é­…åŠ›</span>
                                    <span class="stat-value" id="charmValue">11</span>
                                </div>
                                <input type="range" class="stat-slider" id="charmSlider" min="1" max="10" value="11">
                                <p class="stat-desc">å®¹è²Œæ°”è´¨ã€äººé™…å¸å¼•åŠ›</p>
                            </div>
                        </div>
                        <p class="stat-desc" style="margin-top: 10px; text-align: center;">å½“å‰æ€»åˆ†ï¼š<span id="totalStats">35</span>ï¼ˆå·²è¾¾ä¸Šé™ï¼‰</p>
                    </div>

                    <!-- åˆå§‹åœ°ç‚¹ï¼ˆé€‰æ‹©+å¡«ç©ºï¼‰ -->
                    <div class="form-group">
                        <label class="form-label">åˆå§‹åœ°ç‚¹</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="location" value="æ´›é˜³" checked> æ´›é˜³
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="location" value="è¥„é˜³"> è¥„é˜³
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="location" value="æ±Ÿä¸œ"> æ±Ÿä¸œ
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="location" value="æˆéƒ½"> æˆéƒ½
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="location" value="æ¶¿å¿"> æ¶¿å¿
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="location" value="é•¿å®‰"> é•¿å®‰
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="location" value="è‡ªå®šä¹‰"> è‡ªå®šä¹‰åœ°ç‚¹
                            </label>
                        </div>
                        <div class="custom-input-group" id="customLocationGroup">
                            <input type="text" class="form-input" id="customLocation" placeholder="è¾“å…¥è‡ªå®šä¹‰åœ°ç‚¹ï¼ˆå¦‚ï¼šåºæ±Ÿã€æ±‰ä¸­ã€æ­¦é™µï¼‰">
                        </div>
                    </div>

                    <!-- äººç”Ÿç›®æ ‡ï¼ˆé€‰æ‹©+å¡«ç©ºï¼‰ -->
                    <div class="form-group">
                        <label class="form-label">äººç”Ÿç›®æ ‡ï¼ˆä¸å±€é™äºéœ¸ä¸šï¼‰</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="goal" value="ç›¸å¤«æ•™å­" checked> ç›¸å¤«æ•™å­
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="goal" value="è¾…ä½å¤«å›"> è¾…ä½å¤«å›
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="goal" value="å®ˆæŠ¤å®¶æ—"> å®ˆæŠ¤å®¶æ—
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="goal" value="æ‰¬åç«‹ä¸‡"> æ‰¬åç«‹ä¸‡
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="goal" value="ä¹±ä¸–æ±‚ç”Ÿ"> ä¹±ä¸–æ±‚ç”Ÿ
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="goal" value="è‡ªç”±æ¼‚æ³Š"> è‡ªç”±æ¼‚æ³Š
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="goal" value="è‡ªå®šä¹‰"> è‡ªå®šä¹‰ç›®æ ‡
                            </label>
                        </div>
                        <div class="custom-input-group" id="customGoalGroup">
                            <input type="text" class="form-input" id="customGoal" placeholder="è¾“å…¥è‡ªå®šä¹‰äººç”Ÿç›®æ ‡ï¼ˆå¦‚ï¼šä¼ æ‰¿åŒ»æœ¯ã€å¼€è®¾ç»‡åŠï¼‰">
                        </div>
                    </div>

                    <button type="submit" class="submit-button" data-button-id="step3-submit">ä¸‹ä¸€æ­¥ï¼šé€‰æ‹©åˆå§‹å‰§æƒ…</button>
                </form>
            </div>
            <div class="step-footer">
                <button id="step3-prev" class="recheck-button" data-button-id="step3-prev">è¿”å›ä¸Šä¸€æ­¥</button>
            </div>
        </div>

        <!-- æ­¥éª¤4ï¼šåˆå§‹å‰§æƒ…é€‰æ‹© -->
        <div id="step-4" class="step-content">
            <h2 class="main-title">é€‰æ‹©åˆå§‹å‰§æƒ…</h2>
            <p class="instructions">æŒ‘é€‰ä½ çš„å¼€å±€å‰§æƒ…ï¼Œæˆ–è‡ªå®šä¹‰ä¸“å±å¼€ç¯‡</p>
            <div class="control-panel-container">
                <ul class="scenario-list">
                    <li><button class="scenario-option" data-plot="1" data-button-id="plot-1">æ·±å®…å¤œè¯Â·å¤«å›æ¬²èµ·å…µè®¨è´¼</button></li>
                    <li><button class="scenario-option" data-plot="2" data-button-id="plot-2">ä¹±ä¸–æµäº¡Â·å¸¦æ—äººå¯»æ‰¾å®‰èº«ä¹‹å¤„</button></li>
                    <li><button class="scenario-option" data-plot="3" data-button-id="plot-3">åŒ»é¦†æ•‘äººÂ·æˆ˜ä¹±ä¸­æ•‘æ²»ä¹¡é‚»</button></li>
                    <li><button class="scenario-option" data-plot="4" data-button-id="plot-4">åˆ«é™¢é€¢å‹Â·å¶é‡åå£«å…±è®ºå¤©ä¸‹</button></li>
                    <li><button class="scenario-option" data-plot="5" data-button-id="plot-5">å•†æˆ·å±æœºÂ·å‡ºé¢åŒ–è§£ç»å•†å›°å¢ƒ</button></li>
                    <li><button class="scenario-option" data-plot="custom" data-button-id="plot-custom">è‡ªå®šä¹‰åˆå§‹å‰§æƒ…</button></li>
                </ul>
                <div id="customPlotGroup" class="custom-input-group">
                    <label class="form-label" style="margin-top: 20px;">è‡ªå®šä¹‰å‰§æƒ…ï¼ˆè´´åˆä½ çš„è§’è‰²è®¾å®šï¼‰</label>
                    <textarea class="scenario-textarea" id="customPlot" placeholder="ä¾‹ï¼šä½ æ˜¯åºæ±Ÿå‘¨æ°ä¹‹å¥³ï¼Œå«ä¸å­™ç­–ä¸ºå¦»ï¼Œä»Šæ—¥å­™ç­–å½’æ¥å‘ŠçŸ¥æ¬²è”åˆå‘¨ç‘œå›¾è°‹æ±Ÿä¸œ..."></textarea>
                </div>
            </div>
            <div class="step-footer">
                <button id="step4-prev" class="recheck-button" data-button-id="step4-prev">è¿”å›ä¸Šä¸€æ­¥</button>
                <button id="step4-next" class="recheck-button" data-button-id="step4-next">ç¡®è®¤åˆ›å»ºè§’è‰²</button>
            </div>
        </div>

        <!-- æ­¥éª¤5ï¼šåˆ›å»ºæˆåŠŸ -->
        <div id="step-5" class="step-content">
            <h2 class="main-title">è§’è‰²åˆ›å»ºæˆåŠŸï¼</h2>
            <div class="control-panel-container" style="text-align: center; padding: 20px 15px;">
                <div id="charSummary" style="line-height: 1.8; text-align: left; display: inline-block; width: 100%;">
                    <!-- è§’è‰²æ‘˜è¦å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                </div>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px dashed var(--border-color); text-align: left;">
                    <h3 style="font-family: var(--title-font); color: var(--title-color); margin-bottom: 10px; font-size: 1.2em;">åˆå§‹å‰§æƒ…</h3>
                    <p id="plotSummary" style="text-align: left; display: inline-block; max-width: 100%; font-size: 0.95em;"></p>
                </div>
                <div style="margin-top: 30px;">
                    <button id="startGameBtn" class="submit-button" data-button-id="startGameBtn">å¼€å¯æ±‰æœ«çº¢é¢œä¹‹æ—…</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é€‚é…SillyTavernå…¨å±€å¯¹è±¡ï¼Œé¿å…æœªå®šä¹‰æŠ¥é”™
        const ST = window.SillyTavern || {};

        document.addEventListener('DOMContentLoaded', () => {
            // æ­¥éª¤å…ƒç´ ï¼ˆç”¨displayæ§åˆ¶æ˜¾ç¤º/éšè—ï¼Œé€‚é…SillyTavernï¼‰
            const steps = {
                1: document.getElementById('step-1'),
                2: document.getElementById('step-2'),
                3: document.getElementById('step-3'),
                4: document.getElementById('step-4'),
                5: document.getElementById('step-5')
            };

            // å…¨å±€çŠ¶æ€ï¼ˆåŒæ­¥åˆ°SillyTavernå˜é‡ï¼‰
            let globalState = {
                selectedAction: 'custom',
                selectedScene: null,
                selectedPlot: null,
                customCharData: null,
                stats: { force: 5, body: 7, wisdom: 7, lead: 5, charm: 11 }
            };

            // åˆå§‹åŒ–ï¼šä»SillyTavernè¯»å–çŠ¶æ€ï¼ˆå¦‚æœæœ‰ï¼‰
            if (ST.getVariable) {
                const savedState = ST.getVariable('hanDynastyState') || {};
                globalState = { ...globalState, ...savedState };
                saveStateToST(); // ä¿å­˜åˆå§‹çŠ¶æ€
            }

            // ä¿å­˜çŠ¶æ€åˆ°SillyTavernå˜é‡
            function saveStateToST() {
                if (ST.setVariable) {
                    ST.setVariable('hanDynastyState', globalState);
                    ST.saveChat && ST.saveChat();
                }
            }

            // åˆ‡æ¢æ­¥éª¤ï¼ˆç®€åŒ–DOMæ“ä½œï¼Œé€‚é…ç§»åŠ¨ç«¯å’ŒSillyTavernï¼‰
            function switchToStep(targetStep) {
                // éšè—æ‰€æœ‰æ­¥éª¤
                Object.values(steps).forEach(step => {
                    step.classList.remove('active');
                    step.style.display = 'none';
                });
                // æ˜¾ç¤ºç›®æ ‡æ­¥éª¤
                steps[targetStep].classList.add('active');
                steps[targetStep].style.display = 'block';
                // ä¿å­˜å½“å‰æ­¥éª¤åˆ°çŠ¶æ€
                globalState.currentStep = targetStep;
                saveStateToST();
            }

            // 1. æ­¥éª¤1ï¼šé€‰æ‹©å¼€å±€æ–¹å¼
            bindButton('select-custom', () => {
                globalState.selectedAction = 'custom';
                document.querySelectorAll('.scenario-option[data-action]').forEach(opt => opt.classList.remove('selected'));
                document.querySelector('[data-action="custom"]').classList.add('selected');
                saveStateToST();
            });

            bindButton('select-preset', () => {
                globalState.selectedAction = 'preset';
                document.querySelectorAll('.scenario-option[data-action]').forEach(opt => opt.classList.remove('selected'));
                document.querySelector('[data-action="preset"]').classList.add('selected');
                saveStateToST();
            });

            bindButton('step1-next', () => {
                if (globalState.selectedAction === 'preset') {
                    switchToStep(2);
                } else {
                    switchToStep(3);
                }
            });

            // 2. æ­¥éª¤2ï¼šé¢„è®¾åœºæ™¯é€‰æ‹©
            bindButton('step2-prev', () => {
                switchToStep(1);
                globalState.selectedScene = null;
                document.querySelectorAll('.scenario-option[data-scene]').forEach(opt => opt.classList.remove('selected'));
                saveStateToST();
            });

            // ç»‘å®šåœºæ™¯é€‰æ‹©æŒ‰é’®
            for (let i = 1; i <= 6; i++) {
                bindButton(`scene-${i}`, () => {
                    globalState.selectedScene = i.toString();
                    document.querySelectorAll('.scenario-option[data-scene]').forEach(opt => opt.classList.remove('selected'));
                    document.querySelector(`[data-scene="${i}"]`).classList.add('selected');
                    saveStateToST();
                });
            }

            bindButton('step2-next', () => {
                if (!globalState.selectedScene) {
                    alert('è¯·é€‰æ‹©ä¸€ä¸ªå¼€å±€åœºæ™¯');
                    return;
                }

                // é¢„è®¾è§’è‰²æ•°æ®
                const sceneMap = {
                    '1': {
                        name: 'ç”„æ°',
                        identity: 'è¯¸ä¾¯ä¹‹å¦»',
                        age: 20,
                        spouse: 'è¯¸ä¾¯åå°†',
                        family: 'åé—¨æœ›æ—',
                        location: 'æ´›é˜³',
                        goal: 'è¾…ä½å¤«å›',
                        stats: { force: 4, body: 6, wisdom: 8, lead: 6, charm: 11 }
                    },
                    '2': {
                        name: 'è”¡ç°',
                        identity: 'åå£«ä¹‹å¦»',
                        age: 19,
                        spouse: 'åå£«æ–‡äºº',
                        family: 'ä¹¦é¦™é—¨ç¬¬',
                        location: 'è¥„é˜³',
                        goal: 'æ‰¬åç«‹ä¸‡',
                        stats: { force: 3, body: 5, wisdom: 9, lead: 4, charm: 10 }
                    },
                    '3': {
                        name: 'å´è‹‹',
                        identity: 'å°†é—¨ä¹‹å¦»',
                        age: 22,
                        spouse: 'è¯¸ä¾¯åå°†',
                        family: 'æ­¦å°†ä¸–å®¶',
                        location: 'æ±Ÿä¸œ',
                        goal: 'å®ˆæŠ¤å®¶æ—',
                        stats: { force: 7, body: 8, wisdom: 6, lead: 7, charm: 7 }
                    },
                    '4': {
                        name: 'ç‹æ°',
                        identity: 'å¹³æ°‘ä¹‹å¦»',
                        age: 18,
                        spouse: 'å¹³æ°‘å•†æˆ·',
                        family: 'æ™®é€šå¹³æ°‘',
                        location: 'æ¶¿å¿',
                        goal: 'ç›¸å¤«æ•™å­',
                        stats: { force: 5, body: 8, wisdom: 5, lead: 4, charm: 8 }
                    },
                    '5': {
                        name: 'åˆ˜æ°',
                        identity: 'æµäº¡è´µå¥³',
                        age: 21,
                        spouse: 'æš‚æ— é…å¶',
                        family: 'è´¥è½å®¶æ—',
                        location: 'é•¿å®‰',
                        goal: 'ä¹±ä¸–æ±‚ç”Ÿ',
                        stats: { force: 4, body: 7, wisdom: 8, lead: 5, charm: 9 }
                    },
                    '6': {
                        name: 'å­™æ°',
                        identity: 'å•†æˆ·ä¹‹å¦»',
                        age: 19,
                        spouse: 'å¹³æ°‘å•†æˆ·',
                        family: 'æ™®é€šå¹³æ°‘',
                        location: 'æˆéƒ½',
                        goal: 'è¾…ä½å¤«å›',
                        stats: { force: 3, body: 6, wisdom: 7, lead: 6, charm: 8 }
                    }
                };

                globalState.customCharData = sceneMap[globalState.selectedScene];
                saveStateToST();
                switchToStep(4);
            });

            // 3. æ­¥éª¤3ï¼šè‡ªå®šä¹‰è§’è‰²
            bindButton('step3-prev', () => {
                switchToStep(1);
            });

            // åœ°ç‚¹é€‰æ‹©é€»è¾‘
            document.querySelectorAll('input[name="location"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const customGroup = document.getElementById('customLocationGroup');
                    if (this.value === 'è‡ªå®šä¹‰') {
                        customGroup.classList.add('active');
                        document.getElementById('customLocation').required = true;
                    } else {
                        customGroup.classList.remove('active');
                        document.getElementById('customLocation').required = false;
                    }
                });
            });

            // äººç”Ÿç›®æ ‡é€‰æ‹©é€»è¾‘
            document.querySelectorAll('input[name="goal"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const customGroup = document.getElementById('customGoalGroup');
                    if (this.value === 'è‡ªå®šä¹‰') {
                        customGroup.classList.add('active');
                        document.getElementById('customGoal').required = true;
                    } else {
                        customGroup.classList.remove('active');
                        document.getElementById('customGoal').required = false;
                    }
                });
            });

            // å±æ€§æ»‘å—é€»è¾‘
            const sliders = ['force', 'body', 'wisdom', 'lead', 'charm'];
            sliders.forEach(type => {
                const slider = document.getElementById(`${type}Slider`);
                const valueDisplay = document.getElementById(`${type}Value`);
                
                slider.addEventListener('input', function() {
                    const newValue = parseInt(this.value);
                    const oldValue = globalState.stats[type];
                    const diff = newValue - oldValue;

                    // è®¡ç®—æ€»åˆ†
                    const currentTotal = Object.values(globalState.stats).reduce((a, b) => a + b, 0);
                    const newTotal = currentTotal + diff;

                    if (newTotal <= 35 && newTotal >= 5) {
                        globalState.stats[type] = newValue;
                        valueDisplay.textContent = newValue;
                        document.getElementById('totalStats').textContent = newTotal;
                        saveStateToST();
                    } else {
                        this.value = oldValue; // å›é€€
                    }
                });
            });

            // è¡¨å•æäº¤ï¼ˆè‡ªå®šä¹‰è§’è‰²â†’å‰§æƒ…é€‰æ‹©ï¼‰
            bindFormSubmit('customCharForm', (e) => {
                e.preventDefault();

                const charName = document.getElementById('charName').value.trim();
                const charIdentity = document.getElementById('charIdentity').value.trim();
                const charAge = parseInt(document.getElementById('charAge').value);
                const spouse = document.querySelector('input[name="spouse"]:checked').value;
                const family = document.querySelector('input[name="family"]:checked').value;

                // å¤„ç†åœ°ç‚¹
                const locationRadio = document.querySelector('input[name="location"]:checked');
                let location = locationRadio.value;
                if (location === 'è‡ªå®šä¹‰') {
                    location = document.getElementById('customLocation').value.trim();
                    if (!location) {
                        alert('è¯·è¾“å…¥è‡ªå®šä¹‰åœ°ç‚¹');
                        return;
                    }
                }

                // å¤„ç†ç›®æ ‡
                const goalRadio = document.querySelector('input[name="goal"]:checked');
                let goal = goalRadio.value;
                if (goal === 'è‡ªå®šä¹‰') {
                    goal = document.getElementById('customGoal').value.trim();
                    if (!goal) {
                        alert('è¯·è¾“å…¥è‡ªå®šä¹‰äººç”Ÿç›®æ ‡');
                        return;
                    }
                }

                // ä¿å­˜è‡ªå®šä¹‰è§’è‰²æ•°æ®
                globalState.customCharData = {
                    name: charName,
                    identity: charIdentity,
                    age: charAge,
                    spouse: spouse,
                    family: family,
                    location: location,
                    goal: goal,
                    stats: globalState.stats
                };

                saveStateToST();
                switchToStep(4);
            });

            // 4. æ­¥éª¤4ï¼šå‰§æƒ…é€‰æ‹©
            bindButton('step4-prev', () => {
                // åˆ¤æ–­è¿”å›æ­¥éª¤ï¼šè‡ªå®šä¹‰è§’è‰²â†’æ­¥éª¤3ï¼Œé¢„è®¾åœºæ™¯â†’æ­¥éª¤2
                if (globalState.selectedAction === 'preset') {
                    switchToStep(2);
                } else {
                    switchToStep(3);
                }
            });

            // ç»‘å®šå‰§æƒ…é€‰æ‹©æŒ‰é’®
            for (let i = 1; i <= 5; i++) {
                bindButton(`plot-${i}`, () => {
                    globalState.selectedPlot = i.toString();
                    document.querySelectorAll('.scenario-option[data-plot]').forEach(opt => opt.classList.remove('selected'));
                    document.querySelector(`[data-plot="${i}"]`).classList.add('selected');
                    document.getElementById('customPlotGroup').classList.remove('active');
                    saveStateToST();
                });
            }

            bindButton('plot-custom', () => {
                globalState.selectedPlot = 'custom';
                document.querySelectorAll('.scenario-option[data-plot]').forEach(opt => opt.classList.remove('selected'));
                document.querySelector('[data-plot="custom"]').classList.add('selected');
                document.getElementById('customPlotGroup').classList.add('active');
                saveStateToST();
            });

            bindButton('step4-next', () => {
                if (!globalState.selectedPlot) {
                    alert('è¯·é€‰æ‹©ä¸€ä¸ªåˆå§‹å‰§æƒ…æˆ–è‡ªå®šä¹‰å‰§æƒ…');
                    return;
                }

                if (globalState.selectedPlot === 'custom') {
                    const customPlot = document.getElementById('customPlot').value.trim();
                    if (!customPlot) {
                        alert('è¯·è¾“å…¥è‡ªå®šä¹‰åˆå§‹å‰§æƒ…');
                        return;
                    }
                    globalState.customPlotText = customPlot;
                }

                saveStateToST();
                generateCharSummary();
                switchToStep(5);
            });

            // 5. æ­¥éª¤5ï¼šå¼€å§‹æ¸¸æˆ
            bindButton('startGameBtn', () => {
                if (!ST.chat) {
                    alert('è§’è‰²åˆ›å»ºæˆåŠŸï¼è¯·åœ¨SillyTavernä¸­å¼€å¯å¯¹è¯');
                    return;
                }

                const charData = globalState.customCharData;
                const plotText = getPlotText();

                // ç”Ÿæˆå¼€å±€æ¶ˆæ¯
                const startMessage = `æ±‰æœ«ä¹±ä¸–ï¼Œ${charData.name}ï¼ˆ${charData.identity}ï¼Œ${charData.age}å²ï¼‰äº${charData.location}å¼€å¯äººç”Ÿæ—…ç¨‹ã€‚${charData.spouse}ï¼Œ${charData.family}å‡ºèº«ï¼Œå¿ƒæ€€${charData.goal}ä¹‹å¿—ã€‚å±æ€§ï¼šæ­¦åŠ›${charData.stats.force}ã€ä½“é­„${charData.stats.body}ã€æ™ºè°‹${charData.stats.wisdom}ã€é¢†å¯¼${charData.stats.lead}ã€é­…åŠ›${charData.stats.charm}ã€‚å¼€ç¯‡å‰§æƒ…ï¼š${plotText} æ•…äº‹ç”±æ­¤å±•å¼€...`;

                // åŒæ­¥åˆ°SillyTavernèŠå¤©
                if (ST.chat.length === 0) {
                    ST.createChat && ST.createChat({
                        title: `${charData.name}çš„æ±‰æœ«ä¹‹æ—…`,
                        mes: startMessage,
                        swipes: [startMessage]
                    });
                } else {
                    ST.chat[0].mes = startMessage;
                    ST.chat[0].swipes = [startMessage];
                    ST.saveChat && ST.saveChat();
                }

                // é‡è½½èŠå¤©å¹¶å…³é—­è‡ªå®šä¹‰é¡µé¢ï¼ˆé€‚é…SillyTavernï¼‰
                ST.reloadCurrentChat && ST.reloadCurrentChat();
                if (window.close) {
                    window.close();
                }
            });

            // ç”Ÿæˆè§’è‰²æ‘˜è¦
            function generateCharSummary() {
                const charData = globalState.customCharData;
                const plotText = getPlotText();

                document.getElementById('charSummary').innerHTML = `
                    <h3 style="font-family: var(--title-font); color: var(--title-color); text-align: center; margin-bottom: 15px;">${charData.name} Â· æ±‰æœ«çº¢é¢œæ¡£æ¡ˆ</h3>
                    <p><strong>èº«ä»½èƒŒæ™¯ï¼š</strong>${charData.identity}</p>
                    <p><strong>å¹´é¾„ï¼š</strong>${charData.age}å²</p>
                    <p><strong>é…å¶æƒ…å†µï¼š</strong>${charData.spouse}</p>
                    <p><strong>å®¶æ—èƒŒæ™¯ï¼š</strong>${charData.family}</p>
                    <p><strong>åˆå§‹åœ°ç‚¹ï¼š</strong>${charData.location}</p>
                    <p><strong>äººç”Ÿç›®æ ‡ï¼š</strong>${charData.goal}</p>
                    <p style="margin-top: 15px; padding-top: 15px; border-top: 1px dashed var(--border-color);">
                        <strong>æ ¸å¿ƒå±æ€§ï¼š</strong><br>
                        æ­¦åŠ›ï¼š${charData.stats.force} Â· ä½“é­„ï¼š${charData.stats.body} Â· æ™ºè°‹ï¼š${charData.stats.wisdom} Â· é¢†å¯¼ï¼š${charData.stats.lead} Â· é­…åŠ›ï¼š${charData.stats.charm}
                    </p>
                `;

                document.getElementById('plotSummary').textContent = plotText;
            }

            // è·å–å‰§æƒ…æ–‡æœ¬
            function getPlotText() {
                const plotMap = {
                    '1': 'æ·±å®…å¤œè¯Â·å¤«å›æ¬²èµ·å…µè®¨è´¼ï¼Œé—®ä½ æ„è§â€”â€”ä¹±ä¸–å°†è‡³ï¼Œä½ æ˜¯åŠä»–è°¨æ…è¡Œäº‹ï¼Œè¿˜æ˜¯æ”¯æŒä»–å»ºåŠŸç«‹ä¸šï¼Ÿ',
                    '2': 'ä¹±ä¸–æµäº¡Â·å®¶æ—é­å…µç¥¸ï¼Œä½ å¸¦ç€æ—äººå¯»æ‰¾å®‰èº«ä¹‹å¤„â€”â€”å‰è·¯æ¼«æ¼«ï¼Œæ˜¯æŠ•å¥”äº²å‹ï¼Œè¿˜æ˜¯å¦å¯»ä¸–å¤–æ¡ƒæºï¼Ÿ',
                    '3': 'åŒ»é¦†æ•‘äººÂ·æˆ˜ä¹±ä¸­ç˜Ÿç–«æ¨ªè¡Œï¼Œä½ å‡­åŒ»æœ¯æ•‘æ²»ä¹¡é‚»â€”â€”è¯æåŒ®ä¹ï¼Œæ˜¯ä¼˜å…ˆæ•‘æ²»å¯Œäººæ¢å¾—ç‰©èµ„ï¼Œè¿˜æ˜¯åšå®ˆåŒ»è€…ä»å¿ƒä¸åˆ†è´µè´±ï¼Ÿ',
                    '4': 'åˆ«é™¢é€¢å‹Â·æ¸¸å­¦é€”ä¸­å¶é‡åå£«ï¼Œå…±è®ºå¤©ä¸‹å¤§åŠ¿â€”â€”å¯¹æ–¹é‚€ä½ åŒè¡Œè¾…ä½æ˜ä¸»ï¼Œä½ æ˜¯æ¬£ç„¶åº”å…ï¼Œè¿˜æ˜¯åšå®ˆæœ¬å¿ƒç‹¬å–„å…¶èº«ï¼Ÿ',
                    '5': 'å•†æˆ·å±æœºÂ·å¤«å›ç»å•†é‡åŠ«ï¼Œè´§ç‰©è¢«åŠ«ã€èµ„é‡‘çŸ­ç¼ºâ€”â€”ä½ æ˜¯å‡ºé¢å‘¨æ—‹æƒè´µè®¨å›å…¬é“ï¼Œè¿˜æ˜¯å¦å¯»å•†æœºé‡æŒ¯å®¶ä¸šï¼Ÿ',
                    'custom': globalState.customPlotText || ''
                };

                return plotMap[globalState.selectedPlot];
            }

            // å·¥å…·å‡½æ•°ï¼šç»‘å®šæŒ‰é’®äº‹ä»¶ï¼ˆé€‚é…SillyTavernçš„eventOnButtonï¼‰
            function bindButton(buttonId, callback) {
                // æ–¹å¼1ï¼šä½¿ç”¨SillyTavernçš„eventOnButtonï¼ˆä¼˜å…ˆï¼‰
                if (window.eventOnButton) {
                    eventOnButton(buttonId, callback);
                }
                // æ–¹å¼2ï¼šåŸç”Ÿäº‹ä»¶ç»‘å®šï¼ˆé™çº§ï¼‰
                const button = document.querySelector(`[data-button-id="${buttonId}"]`);
                if (button) {
                    button.addEventListener('click', callback);
                }
            }

            // å·¥å…·å‡½æ•°ï¼šç»‘å®šè¡¨å•æäº¤
            function bindFormSubmit(formId, callback) {
                const form = document.querySelector(`[data-form-id="${formId}"]`);
                if (form) {
                    form.addEventListener('submit', callback);
                }
            }

            // åˆå§‹åŒ–å±æ€§æ˜¾ç¤º
            sliders.forEach(type => {
                document.getElementById(`${type}Value`).textContent = globalState.stats[type];
            });
            document.getElementById('totalStats').textContent = Object.values(globalState.stats).reduce((a, b) => a + b, 0);
        });
    </script>
</body>
</html>
