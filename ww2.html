<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1941 Survival Monitor</title>
    <style>
        /* =========================================
           åŸºç¡€é£æ ¼ï¼šäºŒæˆ˜é‡æˆ˜ç”µå°/æœºå¯†æ¡£æ¡ˆé£æ ¼
           ========================================= */
        :root {
            --bg-dark: #121212;
            --panel-bg: #1e1e1e;
            --text-main: #c0c0c0;
            --text-highlight: #f0f0f0;
            --accent-red: #8a1c1c;   /* å¥åº·/è­¦å‘Š */
            --accent-yellow: #d4a017; /* ä½“èƒ½/è­¦ç¤º */
            --accent-blue: #5f7d8b;   /* ç†æ™º/å†·å³» */
            --border-color: #333;
            --font-stack: "Courier New", Courier, monospace;
        }

        body {
            margin: 0;
            padding: 10px;
            background-color: transparent; /* å…è®¸é€è§†èƒŒæ™¯ */
            color: var(--text-main);
            font-family: var(--font-stack);
            user-select: none;
            overflow: hidden;
        }

        /* ä¸»å®¹å™¨ */
        .dashboard {
            display: grid;
            grid-template-columns: 80px 1fr 200px;
            gap: 10px;
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 2px;
            position: relative;
        }

        /* è£…é¥°æ€§çš„é“†é’‰æ•ˆæœ */
        .dashboard::before, .dashboard::after {
            content: "+";
            position: absolute;
            color: #555;
            font-size: 10px;
        }
        .dashboard::before { top: 2px; left: 2px; }
        .dashboard::after { top: 2px; right: 2px; }

        /* å·¦ä¾§ï¼šå¤´åƒä¸èº«ä»½ */
        .profile-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            border-right: 1px dashed var(--border-color);
            padding-right: 10px;
        }

        .avatar-frame {
            width: 60px;
            height: 60px;
            background: #000;
            border: 2px solid #444;
            margin-bottom: 5px;
            overflow: hidden;
            position: relative;
        }

        .avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: sepia(0.5) contrast(1.2); /* è€ç…§ç‰‡æ»¤é•œ */
        }

        .identity-badge {
            font-size: 10px;
            background: var(--accent-red);
            color: white;
            padding: 1px 4px;
            border-radius: 2px;
            margin-top: 2px;
            text-transform: uppercase;
        }

        /* ä¸­é—´ï¼šç”Ÿå­˜æŒ‡æ ‡æ ¸å¿ƒ */
        .status-section {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 8px;
        }

        .bar-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .bar-label {
            width: 45px;
            font-size: 12px;
            font-weight: bold;
            text-align: right;
        }

        .progress-track {
            flex-grow: 1;
            height: 10px;
            background: #000;
            border: 1px solid #444;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            width: 100%;
            transition: width 0.5s ease, background-color 0.5s ease;
        }

        /* åŠ¨æ€é¢œè‰²ç±» */
        .fill-health { background: var(--accent-red); }
        .fill-stamina { background: var(--accent-yellow); }
        .fill-sanity { background: var(--accent-blue); }

        .bar-value {
            width: 35px;
            font-size: 11px;
            text-align: right;
            font-family: monospace;
        }

        /* å³ä¾§ï¼šç¯å¢ƒä¸ç‰©èµ„ */
        .info-section {
            display: flex;
            flex-direction: column;
            gap: 5px;
            border-left: 1px dashed var(--border-color);
            padding-left: 10px;
            font-size: 11px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
        }

        .info-label { color: #666; }
        .info-val { color: var(--text-highlight); font-weight: bold; }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 3px;
            margin-top: 5px;
        }

        .status-tag {
            background: #333;
            color: #aaa;
            padding: 1px 4px;
            font-size: 9px;
            border: 1px solid #444;
        }
        .status-tag.alert {
            background: #3d0000;
            color: #ff5555;
            border-color: #8a1c1c;
            animation: pulse 2s infinite;
        }

        /* åº•éƒ¨ï¼šæˆ˜æ—¶é€šè®¯æ»šåŠ¨æ¡ */
        .news-ticker {
            grid-column: 1 / -1;
            background: #000;
            color: var(--accent-yellow);
            font-size: 10px;
            padding: 2px 5px;
            white-space: nowrap;
            overflow: hidden;
            border-top: 1px solid var(--border-color);
            margin-top: 5px;
            display: flex;
            align-items: center;
        }

        .ticker-label {
            font-weight: bold;
            margin-right: 10px;
            color: #d4a017;
        }

        .ticker-content {
            display: inline-block;
            animation: marquee 15s linear infinite;
        }

        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

    </style>
</head>
<body>

    <div class="dashboard">
        <!-- 1. å¤´åƒä¸èº«ä»½ -->
        <div class="profile-section">
            <div class="avatar-frame">
                <!-- è¿™é‡Œçš„srcä¼šåœ¨JSä¸­è¢«æ›¿æ¢ -->
                <img id="char-avatar" class="avatar-img" src="" alt="Portrait">
            </div>
            <div id="char-name" style="font-size: 12px; font-weight: bold;">UNKNOWN</div>
            <div id="char-nation" class="identity-badge">N/A</div>
        </div>

        <!-- 2. æ ¸å¿ƒç”Ÿå­˜æŒ‡æ ‡ (HP/STA/SAN) -->
        <div class="status-section">
            <!-- Health -->
            <div class="bar-container">
                <div class="bar-label" style="color:#ff6b6b">HLTH</div>
                <div class="progress-track">
                    <div id="bar-health" class="progress-fill fill-health" style="width: 100%;"></div>
                </div>
                <div id="val-health" class="bar-value">100%</div>
            </div>

            <!-- Stamina -->
            <div class="bar-container">
                <div class="bar-label" style="color:#ffd700">STAM</div>
                <div class="progress-track">
                    <div id="bar-stamina" class="progress-fill fill-stamina" style="width: 100%;"></div>
                </div>
                <div id="val-stamina" class="bar-value">100%</div>
            </div>

            <!-- Sanity -->
            <div class="bar-container">
                <div class="bar-label" style="color:#87ceeb">SANT</div>
                <div class="progress-track">
                    <div id="bar-sanity" class="progress-fill fill-sanity" style="width: 100%;"></div>
                </div>
                <div id="val-sanity" class="bar-value">STABLE</div>
            </div>
        </div>

        <!-- 3. ç¯å¢ƒä¸ç‰©èµ„ -->
        <div class="info-section">
            <div class="info-row">
                <span class="info-label">DATE:</span>
                <span id="info-date" class="info-val">1941-12-07</span>
            </div>
            <div class="info-row">
                <span class="info-label">LOC:</span>
                <span id="info-loc" class="info-val">--</span>
            </div>
            <div class="info-row">
                <span class="info-label">FUNDS:</span>
                <span id="info-money" class="info-val">0</span>
            </div>

            <!-- çŠ¶æ€æ ‡ç­¾å®¹å™¨ -->
            <div id="status-tags" class="tags-container">
                <span class="status-tag">NORMAL</span>
            </div>
        </div>

        <!-- 4. æˆ˜æ—¶é€šè®¯æ»šåŠ¨æ¡ -->
        <div class="news-ticker">
            <span class="ticker-label">>> COMMS:</span>
            <span id="ticker-text" class="ticker-content">ç­‰å¾…ä¿¡å·è¿æ¥... / Waiting for signal...</span>
        </div>
    </div>

<script>
    // ==========================================
    // é€»è¾‘å¤„ç†ï¼šç›‘å¬ SillyTavern çš„æ•°æ®æµ
    // ==========================================

    const setVal = (id, val) => {
        const el = document.getElementById(id);
        if (el) el.innerText = val;
    };

    const setBar = (id, val, max = 100) => {
        const el = document.getElementById(id);
        if (!el) return;
        // ç¡®ä¿æ•°å€¼åœ¨0-100ä¹‹é—´
        let percent = (parseInt(val) / parseInt(max)) * 100;
        percent = Math.max(0, Math.min(100, percent));
        el.style.width = percent + '%';

        // ä½æ•°å€¼å˜è‰²è­¦å‘Šé€»è¾‘
        if (percent < 20) {
            el.style.filter = "brightness(0.7)";
        } else {
            el.style.filter = "none";
        }
    };

    // çŠ¶æ€æ ‡ç­¾æ¸²æŸ“
    const renderTags = (tags) => {
        const container = document.getElementById('status-tags');
        container.innerHTML = '';
        if (!tags || tags.length === 0) return;

        tags.forEach(tag => {
            const span = document.createElement('span');
            span.className = 'status-tag';
            span.innerText = tag;

            // å¦‚æœæ˜¯è´Ÿé¢çŠ¶æ€ï¼ŒåŠ çº¢
            if (['å—ä¼¤', 'æµè¡€', 'é¥¥é¥¿', 'å´©æºƒ', 'é€šç¼‰', 'Wounded', 'Starving'].some(k => tag.includes(k))) {
                span.className += ' alert';
            }
            container.appendChild(span);
        });
    };

    // æ ¸å¿ƒæ›´æ–°å‡½æ•°
    function updateStatus(data) {
        if (!data) return;

        // 1. è§£æåŸºç¡€ä¿¡æ¯
        // å‡è®¾AIè¾“å‡ºçš„å˜é‡è·¯å¾„ç¬¦åˆæˆ‘ä»¬è®¾å®šçš„JSONç»“æ„

        // è§’è‰²å & å¤´åƒ (SillyTaverné€šå¸¸ä¼šé€šè¿‡ifram            width: 100%;
            box-sizing: border-box;
            font-size: 14px;
        }

        /* å·¦ä¾§ï¼šä¸ªäººä¿¡æ¯ä¸èº«ä»½ */
        .section-identity {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 25%;
        }

        .avatar-placeholder {
            width: 48px;
            height: 48px;
            background: #444;
            border: 1px solid #777;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #aaa;
        }

        .info-block {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .name-text {
            font-weight: bold;
            font-size: 16px;
            letter-spacing: 1px;
        }

        .role-text {
            font-size: 12px;
            color: #aaa;
            background: #222;
            padding: 1px 4px;
            border-radius: 2px;
            border: 1px solid #444;
        }

        /* ä¸­é—´ï¼šç”Ÿå­˜ä¸‰ç»´æŒ‡æ ‡ (æ¡çŠ¶) */
        .section-vitals {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 6px;
            width: 40%;
            padding: 0 20px;
            border-left: 1px solid #444;
            border-right: 1px solid #444;
        }

        .vital-row {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
        }

        .vital-label {
            width: 30px;
            font-size: 12px;
            text-align: right;
            opacity: 0.8;
        }

        .bar-container {
            flex-grow: 1;
            height: 8px;
            background: var(--bar-bg);
            border: 1px solid #444;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        /* çŠ¶æ€æŒ‡ç¤ºç¯/æ–‡å­— */
        .vital-value {
            width: 45px;
            font-size: 11px;
            text-align: right;
        }

        /* å³ä¾§ï¼šç¯å¢ƒä¸ç‰©èµ„ */
        .section-environment {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
            gap: 4px;
            width: 30%;
            font-size: 12px;
        }

        .env-row {
            display: flex;
            gap: 10px;
        }

        .location-tag {
            color: #d35400; /* æˆ˜åŒºæ©™ */
        }

        .time-tag {
            color: #999;
        }

        .supplies-grid {
            display: flex;
            gap: 8px;
            margin-top: 4px;
        }

        .supply-item {
            background: #222;
            padding: 2px 6px;
            border: 1px solid #444;
            font-size: 11px;
            color: #bbb;
        }

        /* çŠ¶æ€ä¿®é¥°ç±» */
        .bar-health { background-color: var(--health-color); }
        .bar-stamina { background-color: var(--stamina-color); }
        .bar-mental { background-color: var(--mental-color); }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .status-bar-container { flex-direction: column; height: auto; gap: 10px; }
            .section-identity, .section-vitals, .section-environment { width: 100%; border: none; align-items: flex-start; }
            .section-environment { align-items: flex-start; }
        }
    </style>
</head>
<body>

<div class="status-bar-container">
    <!-- 1. èº«ä»½æ¨¡å—: å¯¹åº” <è§’è‰²:æ¡£æ¡ˆ> -->
    <div class="section-identity">
        <div class="avatar-placeholder">IMG</div>
        <div class="info-block">
            <!-- å¯¹åº” variables_update_rules ä¸­çš„ {{user}} åå­— -->
            <span class="name-text">çº¦ç¿°Â·å¤šä¼Š</span>
            <!-- å¯¹åº” <èº«ä»½>: æ˜¾ç¤ºå½“å‰ä¼ªè£…ï¼Œå¦‚ "èº«ä»½: æˆ˜åœ°è®°è€… (ä¼ªè£…)" -->
            <span class="role-text">èº«ä»½: æŠµæŠ—ç»„ç»‡è”ç»œå‘˜</span>
        </div>
    </div>

    <!-- 2. ç”Ÿå­˜æŒ‡æ ‡æ¨¡å—: å¯¹åº” <è§’è‰²:ç”Ÿç†æŒ‡æ ‡> -->
    <div class="section-vitals">
        <!-- å¥åº·çŠ¶å†µ (Health) -->
        <div class="vital-row">
            <span class="vital-label">H.P.</span>
            <div class="bar-container">
                <!-- width æ ¹æ® å¥åº·çŠ¶å†µ(0-100) åŠ¨æ€è°ƒæ•´ -->
                <div class="bar-fill bar-health" style="width: 75%;"></div>
            </div>
            <span class="vital-value">è½»ä¼¤</span>
        </div>

        <!-- ä½“èƒ½çŠ¶æ€ (Stamina) -->
        <div class="vital-row">
            <span class="vital-label">S.T.</span>
            <div class="bar-container">
                <!-- width æ ¹æ® ä½“èƒ½çŠ¶æ€(0-100) åŠ¨æ€è°ƒæ•´ -->
                <div class="bar-fill bar-stamina" style="width: 40%;"></div>
            </div>
            <span class="vital-value">é¥¥é¥¿</span>
        </div>

        <!-- ç²¾ç¥çŠ¶æ€ (Mental) -->
        <div class="vital-row">
            <span class="vital-label">M.E.</span>
            <div class="bar-container">
                <!-- width æ ¹æ® ç²¾ç¥çŠ¶æ€(æ•°å€¼åŒ–å) åŠ¨æ€è°ƒæ•´ -->
                <div class="bar-fill bar-mental" style="width: 60%;"></div>
            </div>
            <span class="vital-value">ç´§å¼ </span>
        </div>
    </div>

    <!-- 3. ç¯å¢ƒä¸ç‰©èµ„æ¨¡å—: å¯¹åº” <ä¸–ç•Œ> å’Œ <ç‰©èµ„> -->
    <div class="section-environment">
        <div class="env-row">
            <!-- å¯¹åº” <ä¸–ç•Œ:åœ°ç‚¹> -->
            <span class="location-tag">ğŸ“ åæ²™ - çŠ¹å¤ªéš”ç¦»åŒº</span>
            <!-- å¯¹åº” <ä¸–ç•Œ:æ—¶é—´> -->
            <span class="time-tag">1941-10-02 23:15</span>
        </div>

        <!-- å¯¹åº” <è£…å¤‡:æ­¦å™¨> æˆ– <ç‰©èµ„:ç¡¬é€šè´§> -->
        <div class="supplies-grid">
            <div class="supply-item">ğŸ”« é²æ ¼P08 (3/8)</div>
            <div class="supply-item">ğŸ é»‘é¢åŒ… (x1)</div>
            <div class="supply-item">ğŸ’° å¸å›½é©¬å…‹: 50</div>
        </div>
    </div>
</div>

</body>            font-size: 1.8em;
            border-bottom: 1px solid #d3c5b3;
            padding-bottom: 10px;
        }

        h2 {
            font-size: 1.4em;
        }

        .tab {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border: 1px solid #d3c5b3;
            border-radius: 6px;
            background-color: #f9f5f0;
            color: #5d4037;
            font-size: 1em;
            cursor: pointer;
            text-align: center;
        }

        .tab-btn.active {
            background-color: #d7c8b6;
            border-color: #785a4e;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #5d4037;
        }

        input[type="text"], input[type="number"], textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #d3c5b3;
            border-radius: 6px;
            font-size: 1em;
            background-color: #fff;
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px;
            border: 1px solid #d3c5b3;
            border-radius: 6px;
            flex: 1 1 calc(50% - 4px);
        }

        .slider-container {
            margin: 10px 0;
        }

        .slider {
            width: 100%;
            height: 8px;
            accent-color: #785a4e;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 6px;
            background-color: #d7c8b6;
            color: #5d4037;
            font-size: 1.05em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
        }

        .btn-secondary {
            background-color: #f9f5f0;
            border: 1px solid #d3c5b3;
            margin-top: 10px;
        }

        .list-item {
            padding: 12px;
            border: 1px solid #d3c5b3;
            border-radius: 6px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .list-item.selected {
            background-color: #d7c8b6;
            border-color: #785a4e;
        }

        #success {
            display: none;
            text-align: center;
        }

        #summary {
            text-align: left;
            line-height: 1.8;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ±‰æœ«çº¢é¢œå½•</h1>

        <!-- æ ¸å¿ƒé¡µé¢ï¼šè§’è‰²åˆ›å»º -->
        <div id="create">
            <div class="tab">
                <button class="tab-btn active" data-tab="preset">é¢„è®¾åœºæ™¯</button>
                <button class="tab-btn" data-tab="custom">è‡ªå®šä¹‰è§’è‰²</button>
            </div>

            <!-- é¢„è®¾åœºæ™¯ -->
            <div class="tab-content active" id="preset">
                <h2>é€‰æ‹©å¼€å±€åœºæ™¯</h2>
                <div class="list-item" data-scene="1">æ´›é˜³æ·±å®…Â·è¯¸ä¾¯ä¹‹å¦»</div>
                <div class="list-item" data-scene="2">è¥„é˜³åˆ«é™¢Â·åå£«ä¹‹å¦»</div>
                <div class="list-item" data-scene="3">æ±Ÿä¸œæ°´ä¹¡Â·å°†é—¨ä¹‹å¦»</div>
                <div class="list-item" data-scene="4">æ¶¿å¿å†œå®¶Â·å¹³æ°‘ä¹‹å¦»</div>
                <div class="list-item" data-scene="5">é•¿å®‰å¤é“Â·æµäº¡è´µå¥³</div>
                <div class="list-item" data-scene="6">æˆéƒ½å¸‚äº•Â·å•†æˆ·ä¹‹å¦»</div>
                <button class="btn" onclick="selectScene()">ç¡®è®¤åœºæ™¯</button>
            </div>

            <!-- è‡ªå®šä¹‰è§’è‰² -->
            <div class="tab-content" id="custom">
                <h2>è‡ªå®šä¹‰è§’è‰²</h2>
                <div class="form-group">
                    <label>å§“å</label>
                    <input type="text" id="name" placeholder="å¦‚ï¼šç”„æ°" required>
                </div>
                <div class="form-group">
                    <label>èº«ä»½</label>
                    <input type="text" id="identity" placeholder="å¦‚ï¼šéƒ¡å®ˆä¹‹å¥³" required>
                </div>
                <div class="form-group">
                    <label>å¹´é¾„</label>
                    <input type="number" id="age" min="16" max="40" value="18">
                </div>
                <div class="form-group">
                    <label>é…å¶æƒ…å†µ</label>
                    <div class="radio-group">
                        <label class="radio-option"><input type="radio" name="spouse" value="è¯¸ä¾¯åå°†" checked> è¯¸ä¾¯/åå°†</label>
                        <label class="radio-option"><input type="radio" name="spouse" value="åå£«æ–‡äºº"> åå£«/æ–‡äºº</label>
                        <label class="radio-option"><input type="radio" name="spouse" value="å¹³æ°‘å•†æˆ·"> å¹³æ°‘/å•†æˆ·</label>
                        <label class="radio-option"><input type="radio" name="spouse" value="æš‚æ— é…å¶"> æš‚æ— é…å¶</label>
                    </div>
                </div>
                <div class="form-group">
                    <label>æ ¸å¿ƒå±æ€§ï¼ˆæ€»åˆ†35ï¼‰</label>
                    <div class="slider-container">
                        <div class="slider-label"><span>æ­¦åŠ›</span><span id="forceVal">5</span></div>
                        <input type="range" class="slider" id="force" min="1" max="10" value="5" oninput="updateStat('force')">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label"><span>ä½“é­„</span><span id="bodyVal">7</span></div>
                        <input type="range" class="slider" id="body" min="1" max="10" value="7" oninput="updateStat('body')">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label"><span>æ™ºè°‹</span><span id="wisdomVal">7</span></div>
                        <input type="range" class="slider" id="wisdom" min="1" max="10" value="7" oninput="updateStat('wisdom')">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label"><span>é¢†å¯¼</span><span id="leadVal">5</span></div>
                        <input type="range" class="slider" id="lead" min="1" max="10" value="5" oninput="updateStat('lead')">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label"><span>é­…åŠ›</span><span id="charmVal">11</span></div>
                        <input type="range" class="slider" id="charm" min="1" max="10" value="11" oninput="updateStat('charm')">
                    </div>
                </div>
                <button class="btn" onclick="submitCustom()">ç¡®è®¤è§’è‰²</button>
            </div>
        </div>

        <!-- å‰§æƒ…é€‰æ‹© -->
        <div id="plot" style="display: none;">
            <h2>é€‰æ‹©åˆå§‹å‰§æƒ…</h2>
            <div class="list-item" data-plot="1">æ·±å®…å¤œè¯Â·å¤«å›æ¬²èµ·å…µè®¨è´¼</div>
            <div class="list-item" data-plot="2">ä¹±ä¸–æµäº¡Â·å¸¦æ—äººé¿ç¥¸</div>
            <div class="list-item" data-plot="3">åŒ»é¦†æ•‘äººÂ·æˆ˜ä¹±æ²»ç˜Ÿç–«</div>
            <div class="list-item" data-plot="4">å¶é‡åå£«Â·å…±è®ºå¤©ä¸‹</div>
            <div class="list-item" data-plot="5">åŒ–è§£å•†æˆ·å±æœº</div>
            <div class="list-item" data-plot="6">è‡ªå®šä¹‰å‰§æƒ…</div>
            <textarea id="customPlot" placeholder="è¾“å…¥è‡ªå®šä¹‰å‰§æƒ…" style="display: none; margin-top: 10px;"></textarea>
            <button class="btn" onclick="selectPlot()">ç¡®è®¤å‰§æƒ…</button>
            <button class="btn btn-secondary" onclick="backToCreate()">è¿”å›</button>
        </div>

        <!-- æˆåŠŸé¡µ -->
        <div id="success">
            <h2>è§’è‰²åˆ›å»ºæˆåŠŸï¼</h2>
            <div id="summary"></div>
            <button class="btn" onclick="startGame()">å¼€å¯æ—…ç¨‹</button>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€ï¼ˆæç®€ï¼‰
        let state = {
            selectedScene: null,
            selectedPlot: null,
            charData: null,
            stats: { force: 5, body: 7, wisdom: 7, lead: 5, charm: 11 }
        };

        // æ ‡ç­¾åˆ‡æ¢
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.dataset.tab;
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(tab).classList.add('active');
            });
        });

        // é¢„è®¾åœºæ™¯é€‰æ‹©
        document.querySelectorAll('.list-item[data-scene]').forEach(item => {
            item.addEventListener('click', () => {
                state.selectedScene = item.dataset.scene;
                document.querySelectorAll('.list-item[data-scene]').forEach(i => i.classList.remove('selected'));
                item.classList.add('selected');
            });
        });

        // å‰§æƒ…é€‰æ‹©
        document.querySelectorAll('.list-item[data-plot]').forEach(item => {
            item.addEventListener('click', () => {
                state.selectedPlot = item.dataset.plot;
                document.querySelectorAll('.list-item[data-plot]').forEach(i => i.classList.remove('selected'));
                item.classList.add('selected');
                document.getElementById('customPlot').style.display = state.selectedPlot === '6' ? 'block' : 'none';
            });
        });

        // å±æ€§æ›´æ–°
        function updateStat(type) {
            const val = document.getElementById(type).value;
            const diff = val - state.stats[type];
            const total = Object.values(state.stats).reduce((a, b) => a + b, 0);
            if (total + diff <= 35 && total + diff >= 5) {
                state.stats[type] = parseInt(val);
                document.getElementById(`${type}Val`).textContent = val;
            } else {
                document.getElementById(type).value = state.stats[type];
            }
        }

        // é€‰æ‹©åœºæ™¯
        function selectScene() {
            if (!state.selectedScene) {
                alert('è¯·é€‰æ‹©åœºæ™¯');
                return;
            }
            const sceneMap = {
                '1': { name: 'ç”„æ°', identity: 'è¯¸ä¾¯ä¹‹å¦»', age: 20, spouse: 'è¯¸ä¾¯åå°†', stats: { force: 4, body: 6, wisdom: 8, lead: 6, charm: 11 }, location: 'æ´›é˜³', goal: 'è¾…ä½å¤«å›' },
                '2': { name: 'è”¡ç°', identity: 'åå£«ä¹‹å¦»', age: 19, spouse: 'åå£«æ–‡äºº', stats: { force: 3, body: 5, wisdom: 9, lead: 4, charm: 10 }, location: 'è¥„é˜³', goal: 'æ‰¬åç«‹ä¸‡' },
                '3': { name: 'å´è‹‹', identity: 'å°†é—¨ä¹‹å¦»', age: 22, spouse: 'è¯¸ä¾¯åå°†', stats: { force: 7, body: 8, wisdom: 6, lead: 7, charm: 7 }, location: 'æ±Ÿä¸œ', goal: 'å®ˆæŠ¤å®¶æ—' },
                '4': { name: 'ç‹æ°', identity: 'å¹³æ°‘ä¹‹å¦»', age: 18, spouse: 'å¹³æ°‘å•†æˆ·', stats: { force: 5, body: 8, wisdom: 5, lead: 4, charm: 8 }, location: 'æ¶¿å¿', goal: 'ç›¸å¤«æ•™å­' },
                '5': { name: 'åˆ˜æ°', identity: 'æµäº¡è´µå¥³', age: 21, spouse: 'æš‚æ— é…å¶', stats: { force: 4, body: 7, wisdom: 8, lead: 5, charm: 9 }, location: 'é•¿å®‰', goal: 'ä¹±ä¸–æ±‚ç”Ÿ' },
                '6': { name: 'å­™æ°', identity: 'å•†æˆ·ä¹‹å¦»', age: 19, spouse: 'å¹³æ°‘å•†æˆ·', stats: { force: 3, body: 6, wisdom: 7, lead: 6, charm: 8 }, location: 'æˆéƒ½', goal: 'è¾…ä½å¤«å›' }
            };
            state.charData = sceneMap[state.selectedScene];
            document.getElementById('create').style.display = 'none';
            document.getElementById('plot').style.display = 'block';
        }

        // æäº¤è‡ªå®šä¹‰è§’è‰²
        function submitCustom() {
            const name = document.getElementById('name').value.trim();
            const identity = document.getElementById('identity').value.trim();
            if (!name || !identity) {
                alert('è¯·å¡«å†™å§“åå’Œèº«ä»½');
                return;
            }
            state.charData = {
                name: name,
                identity: identity,
                age: document.getElementById('age').value,
                spouse: document.querySelector('input[name="spouse"]:checked').value,
                stats: state.stats,
                location: 'æ´›é˜³',
                goal: 'ç›¸å¤«æ•™å­'
            };
            document.getElementById('create').style.display = 'none';
            document.getElementById('plot').style.display = 'block';
        }

        // é€‰æ‹©å‰§æƒ…
        function selectPlot() {
            if (!state.selectedPlot) {
                alert('è¯·é€‰æ‹©å‰§æƒ…');
                return;
            }
            const plotMap = {
                '1': 'æ·±å®…å¤œè¯Â·å¤«å›æ¬²èµ·å…µè®¨è´¼ï¼Œé—®ä½ æ„è§',
                '2': 'ä¹±ä¸–æµäº¡Â·å®¶æ—é­å…µç¥¸ï¼Œå¸¦æ—äººå¯»æ‰¾å®‰èº«ä¹‹å¤„',
                '3': 'åŒ»é¦†æ•‘äººÂ·æˆ˜ä¹±ä¸­ç˜Ÿç–«æ¨ªè¡Œï¼Œå‡­åŒ»æœ¯æ•‘æ²»ä¹¡é‚»',
                '4': 'å¶é‡åå£«Â·æ¸¸å­¦é€”ä¸­å¶é‡åå£«ï¼Œå…±è®ºå¤©ä¸‹å¤§åŠ¿',
                '5': 'åŒ–è§£å•†æˆ·å±æœºÂ·å¤«å›ç»å•†é‡åŠ«ï¼Œå‡ºé¢è§£å†³',
                '6': document.getElementById('customPlot').value.trim() || 'è‡ªå®šä¹‰å‰§æƒ…ï¼šä¹±ä¸–å¼€å¯æ–°æ—…ç¨‹'
            };
            const plotText = plotMap[state.selectedPlot];
            document.getElementById('summary').innerHTML = `
                <p>å§“åï¼š${state.charData.name}</p>
                <p>èº«ä»½ï¼š${state.charData.identity}ï¼ˆ${state.charData.age}å²ï¼‰</p>
                <p>é…å¶ï¼š${state.charData.spouse}</p>
                <p>å±æ€§ï¼šæ­¦åŠ›${state.charData.stats.force} Â· ä½“é­„${state.charData.stats.body} Â· æ™ºè°‹${state.charData.stats.wisdom} Â· é¢†å¯¼${state.charData.stats.lead} Â· é­…åŠ›${state.charData.stats.charm}</p>
                <p>å‰§æƒ…ï¼š${plotText}</p>
            `;
            document.getElementById('plot').style.display = 'none';
            document.getElementById('success').style.display = 'block';
        }

        // è¿”å›è§’è‰²åˆ›å»º
        function backToCreate() {
            document.getElementById('plot').style.display = 'none';
            document.getElementById('create').style.display = 'block';
        }

        // å¯åŠ¨æ¸¸æˆï¼ˆé€‚é…STï¼‰
        function startGame() {
            const ST = window.SillyTavern || {};
            const char = state.charData;
            const plotText = document.querySelector('#summary p:last-child').textContent.replace('å‰§æƒ…ï¼š', '');
            const startMsg = `æ±‰æœ«ä¹±ä¸–ï¼Œ${char.name}ï¼ˆ${char.identity}ï¼Œ${char.age}å²ï¼‰å¼€å¯æ—…ç¨‹ã€‚${char.spouse}ï¼Œå±æ€§ï¼šæ­¦åŠ›${char.stats.force}ã€ä½“é­„${char.stats.body}ã€æ™ºè°‹${char.stats.wisdom}ã€é¢†å¯¼${char.stats.lead}ã€é­…åŠ›${char.stats.charm}ã€‚å‰§æƒ…ï¼š${plotText} æ•…äº‹å±•å¼€...`;

            if (ST.chat && ST.createChat) {
                ST.createChat({ title: `${char.name}çš„æ±‰æœ«ä¹‹æ—…`, mes: startMsg, swipes: [startMsg] });
                ST.saveChat && ST.saveChat();
                ST.reloadCurrentChat && ST.reloadCurrentChat();
                window.close && window.close();
            } else {
                alert('è§’è‰²åˆ›å»ºæˆåŠŸï¼è¯·åœ¨SillyTavernä¸­å¼€å¯å¯¹è¯');
            }
        }
    </script>
</body>
</html>
